# Визуализация работы filterOpponentRange

Этот документ показывает, как работает фильтрация диапазона на конкретных примерах.

## Пример 1: Базовая фильтрация AA

### Входные данные
```
Диапазон оппонента: ["AA"]
Карты Hero: [Ah, Kd]
Борд: нет
```

### Шаг 1: Разворачиваем AA во все комбинации

```
AA без блокеров = 6 комбинаций:
┌───────────────────────────┐
│ 1. [Ah, As]               │
│ 2. [Ah, Ad]               │
│ 3. [Ah, Ac]               │
│ 4. [As, Ad]               │
│ 5. [As, Ac]               │
│ 6. [Ad, Ac]               │
└───────────────────────────┘
```

### Шаг 2: Собираем блокеры

```
Блокеры:
┌───────────────┐
│ - Ah (Hero)   │
│ - Kd (Hero)   │
└───────────────┘
```

### Шаг 3: Фильтруем комбинации

```
Проверка каждой комбинации:
1. [Ah, As] → ЗАБЛОКИРОВАНА ✗ (содержит Ah)
2. [Ah, Ad] → ЗАБЛОКИРОВАНА ✗ (содержит Ah)
3. [Ah, Ac] → ЗАБЛОКИРОВАНА ✗ (содержит Ah)
4. [As, Ad] → ДОСТУПНА ✓
5. [As, Ac] → ДОСТУПНА ✓
6. [Ad, Ac] → ДОСТУПНА ✓
```

### Результат

```
┌─────────────────────────────────┐
│ Всего: 6 комбинаций             │
│ После фильтрации: 3 комбинации  │
│ Процент: 50%                    │
│                                 │
│ Оставшиеся:                     │
│ - [As, Ad]                      │
│ - [As, Ac]                      │
│ - [Ad, Ac]                      │
└─────────────────────────────────┘
```

---

## Пример 2: AKs с блокерами

### Входные данные
```
Диапазон оппонента: ["AKs"]
Карты Hero: [Ah, Kh]
Борд: нет
```

### Шаг 1: Разворачиваем AKs

```
AKs (suited - одной масти) = 4 комбинации:
┌────────────────────────────┐
│ 1. [Ah, Kh] ♥              │
│ 2. [As, Ks] ♠              │
│ 3. [Ad, Kd] ♦              │
│ 4. [Ac, Kc] ♣              │
└────────────────────────────┘
```

### Шаг 2: Блокеры

```
Блокеры:
┌───────────────┐
│ - Ah ♥        │
│ - Kh ♥        │
└───────────────┘
```

### Шаг 3: Фильтрация

```
1. [Ah, Kh] → ЗАБЛОКИРОВАНА ✗ (полное совпадение!)
2. [As, Ks] → ДОСТУПНА ✓
3. [Ad, Kd] → ДОСТУПНА ✓
4. [Ac, Kc] → ДОСТУПНА ✓
```

### Результат

```
┌─────────────────────────────────┐
│ Всего: 4 комбинации             │
│ После фильтрации: 3 комбинации  │
│ Процент: 75%                    │
└─────────────────────────────────┘
```

---

## Пример 3: Полный борд (флоп + тёрн + ривер)

### Входные данные
```
Диапазон оппонента: ["KK", "QQ"]
Карты Hero: [Ah, As]
Борд: [Kh, Kd, Kc, Qh, Jd]
```

### Визуализация борда
```
        ФЛОП          ТЁРН   РИВЕР
    ┌────┬────┬────┐  ┌────┐ ┌────┐
    │ Kh │ Kd │ Kc │  │ Qh │ │ Jd │
    └────┴────┴────┘  └────┘ └────┘
```

### Анализ KK

```
KK без блокеров = 6 комбинаций
Блокеры: 3 короля на борде (Kh, Kd, Kc)

Все комбинации KK:
1. [Kh, Ks] → ЗАБЛОКИРОВАНА ✗ (Kh на борде)
2. [Kh, Kd] → ЗАБЛОКИРОВАНА ✗ (оба на борде)
3. [Kh, Kc] → ЗАБЛОКИРОВАНА ✗ (оба на борде)
4. [Ks, Kd] → ЗАБЛОКИРОВАНА ✗ (Kd на борде)
5. [Ks, Kc] → ЗАБЛОКИРОВАНА ✗ (Kc на борде)
6. [Kd, Kc] → ЗАБЛОКИРОВАНА ✗ (оба на борде)

Результат: 0 комбинаций ✗
```

### Анализ QQ

```
QQ без блокеров = 6 комбинаций
Блокеры: 1 дама на борде (Qh)

Все комбинации QQ:
1. [Qh, Qs] → ЗАБЛОКИРОВАНА ✗ (Qh на борде)
2. [Qh, Qd] → ЗАБЛОКИРОВАНА ✗ (Qh на борде)
3. [Qh, Qc] → ЗАБЛОКИРОВАНА ✗ (Qh на борде)
4. [Qs, Qd] → ДОСТУПНА ✓
5. [Qs, Qc] → ДОСТУПНА ✓
6. [Qd, Qc] → ДОСТУПНА ✓

Результат: 3 комбинации ✓
```

### Общий результат

```
┌──────────────────────────────────────┐
│ KK: 6 → 0 комбинаций (невозможно!)  │
│ QQ: 6 → 3 комбинации (50%)          │
│                                      │
│ Всего: 12 → 3 комбинации (25%)      │
└──────────────────────────────────────┘
```

---

## Пример 4: AKo (offsuit) с частичными блокерами

### Входные данные
```
Диапазон оппонента: ["AKo"]
Карты Hero: [Ah, Qd]
Борд: нет
```

### Разворот AKo

```
AKo (offsuit - разных мастей) = 12 комбинаций:
┌──────────────────────────────────────┐
│  1. [Ah, Ks]   5. [As, Kd]   9. [Ad, Kh] │
│  2. [Ah, Kd]   6. [As, Kc]  10. [Ad, Ks]│
│  3. [Ah, Kc]   7. [As, Kh]  11. [Ad, Kc]│
│  4. [As, Kd]   8. [As, Kc]  12. [Ac, Kh]│
│     ...                          ...     │
└──────────────────────────────────────┘
```

### Фильтрация

```
Блокер: Ah

Заблокированные:
- [Ah, Ks] ✗
- [Ah, Kd] ✗
- [Ah, Kc] ✗

Доступные (9 комбинаций):
- [As, Kh] ✓
- [As, Kd] ✓
- [As, Kc] ✓
- [Ad, Kh] ✓
- [Ad, Ks] ✓
- [Ad, Kc] ✓
- [Ac, Kh] ✓
- [Ac, Ks] ✓
- [Ac, Kd] ✓
```

### Результат

```
┌─────────────────────────────────┐
│ Всего: 12 комбинаций            │
│ После фильтрации: 9 комбинаций  │
│ Процент: 75%                    │
└─────────────────────────────────┘
```

---

## Пример 5: Большой диапазон

### Входные данные
```
Диапазон оппонента: ["AA", "KK", "QQ", "JJ", "AKs", "AKo"]
Карты Hero: [Ah, Kd]
Борд: [Qh, Jh, Th, null, null]
```

### Таблица результатов

```
┌──────────┬─────────────┬──────────────┬──────────┐
│ Рука     │ Без блокеров│ С блокерами  │ Процент  │
├──────────┼─────────────┼──────────────┼──────────┤
│ AA       │      6      │      3       │   50%    │
│ KK       │      6      │      3       │   50%    │
│ QQ       │      6      │      3       │   50%    │
│ JJ       │      6      │      3       │   50%    │
│ AKs      │      4      │      1       │   25%    │
│ AKo      │     12      │      5       │   42%    │
├──────────┼─────────────┼──────────────┼──────────┤
│ ИТОГО    │     40      │     18       │   45%    │
└──────────┴─────────────┴──────────────┴──────────┘
```

### Детализация AKs

```
Блокеры: Ah, Kd, Qh, Jh, Th

AKs комбинации:
1. [Ah, Kh] → ✗ (Ah и Kh/Th/Jh/Qh конфликты)
2. [As, Ks] → ✓ (доступна!)
3. [Ad, Kd] → ✗ (Kd у Hero)
4. [Ac, Kc] → ✗ (нужны обе, но Ac и Kc разные)

Только 1 комбинация доступна!
```

---

## Практическое применение

### В расчете эквити

```typescript
// До фильтрации
const opponentRange = ['AA', 'KK', 'QQ'];
// Эквити будет неточным!

// После фильтрации
const { filteredCombinations } = filterOpponentRange({
  opponentRange: ['AA', 'KK', 'QQ'],
  heroCards: ['Ah', 'Kd'],
  boardCards: boardState
});

// Теперь эквити точный - учитываются только возможные руки
```

### В визуализации диапазона

```typescript
// Показать пользователю, какие комбинации возможны
const combosPerHand = getCombinationsPerHand({
  opponentRange,
  heroCards,
  boardCards
});

combosPerHand.forEach((count, hand) => {
  console.log(`${hand}: ${count} комбо`);
  // AA: 3 комбо
  // KK: 0 комбо (невозможно!)
});
```

---

## Заключение

Фильтрация блокеров критически важна для:
- ✅ Точного расчета эквити
- ✅ Анализа диапазонов оппонента
- ✅ Принятия решений на постфлопе
- ✅ Обучения покерной математике
